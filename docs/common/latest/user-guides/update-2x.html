<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Update Guide to version 2.x for OpenDevStack users :: OpenDevStack</title>
    <link rel="canonical" href="https://www.opendevstack.org/ods-documentation/common/latest/user-guides/update-2x.html">
    <meta name="generator" content="Antora 2.2.0">
    <link rel="stylesheet" href="../../../_/css/site.css">
<link rel="stylesheet" href="../../../_/css/search.css">
  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.opendevstack.org/ods-documentation">OpenDevStack</a>
        <div class="navbar-item">
          <input id="search-input" type="text" placeholder="Search docs">
        </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Components</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="https://www.opendevstack.org/ods-documentation/common/latest/index.html">Guides and Tutorials</a>
            <a class="navbar-item" href="https://www.opendevstack.org/ods-documentation/ods-jenkins-shared-library/latest/index.html">Jenkins Shared Library</a>
            <a class="navbar-item" href="https://www.opendevstack.org/ods-documentation/ods-core/latest/infrastructure-setup/index.html">ODS Core</a>
            <a class="navbar-item" href="https://www.opendevstack.org/ods-documentation/ods-project-quickstarters/1.2/index.html">ODS Project Quickstarters</a>
            <a class="navbar-item" href="https://www.opendevstack.org/ods-documentation/ods-quickstarters/latest/index.html">ODS Quickstarters</a>
            <a class="navbar-item" href="https://www.opendevstack.org/ods-documentation/ods-provisioning-app/latest/index.html">Provisioning App</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="common" data-version="latest">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title">ODS Components</h3>
    <ul class="nav-list">
  <li class="nav-item" data-depth="0">
      <a class="nav-link" href="../index.html">Guides and Tutorials</a>
      </li>
  <li class="nav-item" data-depth="0">
      <a class="nav-link" href="../../../ods-jenkins-shared-library/latest/index.html">Jenkins Shared Library</a>
      </li>
  <li class="nav-item" data-depth="0">
      <a class="nav-link" href="../../../ods-core/latest/infrastructure-setup/index.html">ODS Core</a>
      </li>
  <li class="nav-item" data-depth="0">
      <a class="nav-link" href="../../../ods-project-quickstarters/1.2/index.html">ODS Project Quickstarters</a>
      </li>
  <li class="nav-item" data-depth="0">
      <a class="nav-link" href="../../../ods-quickstarters/latest/index.html">ODS Quickstarters</a>
      </li>
  <li class="nav-item" data-depth="0">
      <a class="nav-link" href="../../../ods-provisioning-app/latest/index.html">Provisioning App</a>
      </li>
    </ul>
    <h3 class="title"><a href="../index.html">Guides and Tutorials</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../getting-started/introduction.html">Introduction</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">User Guides</span>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="update-2x.html">Update to 2.x</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Administrator Guide</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../administrator-guides/update.html">Version update</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Local Install</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../administrator-guides/install-requirements.html">Requirements</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../administrator-guides/install-guide.html">Installation</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Contributor Guides</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contributor-guides/development.html">Development</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contributor-guides/documentation.html">Documentation</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Guides and Tutorials</span>
    <span class="version">latest</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Guides and Tutorials</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">latest</a>
        </li>
        <li class="version">
          <a href="../../1.2/index.html">1.2</a>
        </li>
        <li class="version">
          <a href="../../1.1/index.html">1.1</a>
        </li>
        <li class="version">
          <a href="../../v1.0/index.html">v1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Jenkins Shared Library</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../ods-jenkins-shared-library/latest/index.html">latest</a>
        </li>
        <li class="version">
          <a href="../../../ods-jenkins-shared-library/2/index.html">2</a>
        </li>
        <li class="version">
          <a href="../../../ods-jenkins-shared-library/1.2/index.html">1.2</a>
        </li>
        <li class="version">
          <a href="../../../ods-jenkins-shared-library/1.1/index.html">1.1</a>
        </li>
        <li class="version">
          <a href="../../../ods-jenkins-shared-library/v1.0/index.html">v1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">ODS Core</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../ods-core/latest/infrastructure-setup/index.html">latest</a>
        </li>
        <li class="version">
          <a href="../../../ods-core/2/infrastructure-setup/index.html">2</a>
        </li>
        <li class="version">
          <a href="../../../ods-core/1.2/infrastructure-setup/index.html">1.2</a>
        </li>
        <li class="version">
          <a href="../../../ods-core/1.1/infrastructure-setup/index.html">1.1</a>
        </li>
        <li class="version">
          <a href="../../../ods-core/v1.0/infrastructure-setup/index.html">v1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">ODS Project Quickstarters</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../ods-project-quickstarters/1.2/index.html">1.2</a>
        </li>
        <li class="version">
          <a href="../../../ods-project-quickstarters/1.1/index.html">1.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">ODS Quickstarters</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../ods-quickstarters/latest/index.html">latest</a>
        </li>
        <li class="version">
          <a href="../../../ods-quickstarters/2/index.html">2</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Provisioning App</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../ods-provisioning-app/latest/index.html">latest</a>
        </li>
        <li class="version">
          <a href="../../../ods-provisioning-app/2/index.html">2</a>
        </li>
        <li class="version">
          <a href="../../../ods-provisioning-app/1.2/index.html">1.2</a>
        </li>
        <li class="version">
          <a href="../../../ods-provisioning-app/1.1/index.html">1.1</a>
        </li>
        <li class="version">
          <a href="../../../ods-provisioning-app/v1.0/index.html">v1.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main>
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../getting-started/introduction.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Guides and Tutorials</a></li>
    <li>User Guides</li>
    <li><a href="update-2x.html">Update to 2.x</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">latest</button>
  <div class="version-menu">
    <a class="version is-current" href="update-2x.html">latest</a>
    <a class="version is-missing" href="../../1.2/index.html">1.2</a>
    <a class="version is-missing" href="../../1.1/index.html">1.1</a>
    <a class="version is-missing" href="../../v1.0/index.html">v1.0</a>
  </div>
</div>
  <div class="edit-this-page"><a href="https://github.com/opendevstack/opendevstack.github.io/edit/master/docs/modules/user-guides/pages/update-2x.adoc">Edit this Page</a></div>
  </div>
<article class="doc"><a name="section-top"></a>
<h1 class="page">Update Guide to version 2.x for OpenDevStack users</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_required_steps">Required steps</a>
<ul class="sectlevel2">
<li><a href="#_update_version_references">Update version references</a></li>
<li><a href="#_grant_image_puller_rights_to_your_cd_namespace">Grant image-puller rights to your <code>*-cd</code> namespace</a></li>
<li><a href="#_component_resource_constraints">Component resource constraints</a></li>
</ul>
</li>
<li><a href="#_notable_changes">Notable changes</a>
<ul class="sectlevel2">
<li><a href="#_component_deployment_behaviour">Component deployment behaviour</a></li>
<li><a href="#_jenkins_slave_nodejs_8">Jenkins slave NodeJS 8</a></li>
<li><a href="#_new_tailor_version">New Tailor version</a></li>
<li><a href="#_deprecation_of_shared_services_namespace">Deprecation of <code>shared-services</code> namespace</a></li>
</ul>
</li>
<li><a href="#_new_features">New features</a>
<ul class="sectlevel2">
<li><a href="#_sonarqube_quality_gates">SonarQube quality gates</a></li>
<li><a href="#_skopeo">Skopeo</a></li>
</ul>
</li>
<li><a href="#_common_known_issues">Common / Known Issues</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Learn all about how to update your OpenDevStack based project to ODS 2.x.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is assumed that you are updating from ODS 1.2.x.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_required_steps"><a class="anchor" href="#_required_steps"></a>Required steps</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_update_version_references"><a class="anchor" href="#_update_version_references"></a>Update version references</h3>
<div class="paragraph">
<p>First, go into your <code>*-cd</code> namespace and edit the deployments (<code>jenkins</code> and
<code>webhook-proxy</code>) to point to the new tags (via "Actions" &gt; "Edit").</p>
</div>
<div class="paragraph">
<p>Then, edit every <code>Jenkinsfile</code>. The shared library should point to <code>2.x</code>, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">library identifier: 'ods-library@2.x', retriever: modernSCM(
  [$class: 'GitSCMSource',
   remote: sharedLibraryRepository,
   credentialsId: credentialsId])</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also, the image used to run the pipeline in should point to <code>2.x</code>, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">odsPipeline(
  image: "${dockerRegistry}/cd/jenkins-slave-maven:2.x",
  ...
)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_grant_image_puller_rights_to_your_cd_namespace"><a class="anchor" href="#_grant_image_puller_rights_to_your_cd_namespace"></a>Grant image-puller rights to your <code>*-cd</code> namespace</h3>
<div class="paragraph">
<p>This step is not strictly necessary, but recommended as projects created with
version <code>2.x</code> will have those rights by default. Having this setup will enable
you to use the <code>*-cd</code> namespace for common base images to reduce build times.</p>
</div>
<div class="paragraph">
<p>Run the following, replacing <code>$PROJECT_ID</code> with your project ID:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">oc policy add-role-to-group system:image-puller system:serviceaccounts:$PROJECT_ID-test -n $PROJECT_ID-cd
oc policy add-role-to-group system:image-puller system:serviceaccounts:$PROJECT_ID-dev -n $PROJECT_ID-cd</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information, see <a href="https://github.com/opendevstack/ods-core/issues/293">ods-core#293</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_component_resource_constraints"><a class="anchor" href="#_component_resource_constraints"></a>Component resource constraints</h3>
<div class="paragraph">
<p>Newly created components now have memory quotas
(<a href="https://github.com/opendevstack/ods-quickstarters/issues/12">ods-quickstarters#12</a>)
and CPU quotas (<a href="https://github.com/opendevstack/ods-quickstarters/issues/74">ods-quickstarters#74</a>)
configured.</p>
</div>
<div class="paragraph">
<p>It is recommended (though not required) to configure resource constraints for
existing components as well. If you are unsure which values to set, refer to the
new defaults and check the current usage in the "Metrics" section in OpenShift.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_notable_changes"><a class="anchor" href="#_notable_changes"></a>Notable changes</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_component_deployment_behaviour"><a class="anchor" href="#_component_deployment_behaviour"></a>Component deployment behaviour</h3>
<div class="paragraph">
<p>In the shared library, rollouts will be triggered manually now when no config/image trigger exists on the DeploymentConfig.</p>
</div>
</div>
<div class="sect2">
<h3 id="_jenkins_slave_nodejs_8"><a class="anchor" href="#_jenkins_slave_nodejs_8"></a>Jenkins slave NodeJS 8</h3>
<div class="paragraph">
<p>The <code>cd/jenkins-slave-nodejs8-angular</code> image has been discontinued. Please update to
<code>cd/jenkins-slave-nodejs10-angular</code>. For more information, see <a href="https://github.com/opendevstack/ods-quickstarters/issues/71">ods-quickstarters#71</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_new_tailor_version"><a class="anchor" href="#_new_tailor_version"></a>New Tailor version</h3>
<div class="paragraph">
<p>Tailor has been updated to 0.11.0 in the Jenkins slaves, see <a href="https://github.com/opendevstack/ods-core/issues/290">ods-core#290</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_deprecation_of_shared_services_namespace"><a class="anchor" href="#_deprecation_of_shared_services_namespace"></a>Deprecation of <code>shared-services</code> namespace</h3>
<div class="paragraph">
<p>The <code>shared-images</code> namespace (containing common base images) has been
removed from new ODS 2.0 installation. For existing installations, it is likely
being kept for some time by the cluster administrator to enable users to react
to this change.</p>
</div>
<div class="paragraph">
<p>If you use a component based on the <code>ds-jupyter-notebook</code> or <code>ds-rshiny</code>
quickstarters, you should switch to using the new authentication approach, which
is uing an OpenShift OAuth proxy instead of a Nginx service. See
<a href="https://github.com/opendevstack/ods-quickstarters/issues/46">ods-quickstarters#46</a>.</p>
</div>
<div class="paragraph">
<p>If you use the Airflow Quickstarter, its base images should now be built in your
<code>*-cd</code> namespace See
<a href="https://github.com/opendevstack/ods-quickstarters/issues/60">ods-quickstarters#60</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_new_features"><a class="anchor" href="#_new_features"></a>New features</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_sonarqube_quality_gates"><a class="anchor" href="#_sonarqube_quality_gates"></a>SonarQube quality gates</h3>
<div class="paragraph">
<p>It is now possible to opt-in to failing the build if the SonarQube scan fails
the quality gate defined in SonarQube. To enable this, change the call of
<code>stageScanForSonarqube(context)</code> to <code>stageScanForSonarqube(context, true)</code>.
For more information, see <a href="https://github.com/opendevstack/ods-jenkins-shared-library/issues/22">ods-jenkins-shared-library#22</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_skopeo"><a class="anchor" href="#_skopeo"></a>Skopeo</h3>
<div class="paragraph">
<p>When working with images, you may make use of Skopeo, which is now part of the Jenkins slaves. See <a href="https://github.com/opendevstack/ods-core/issues/253">ods-core#253</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_common_known_issues"><a class="anchor" href="#_common_known_issues"></a>Common / Known Issues</h2>
<div class="sectionbody">
<div class="paragraph">
<p>None at this point.</p>
</div>
</div>
</div>
</article>
<aside class="article-aside hidden" role="navigation">
  <h3 class="toc-title">Contents</h3>
  <div id="article-toc"></div>
</aside>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.1.1/tocbot.min.js"></script>
<script type="text/javascript">
  window.antora = window.antora || {}
  window.antora.basePath = '../../..'
  window.antora.pagePath = '/common/latest/user-guides/update-2x.html'
</script>
<script src="../../../_/js/site.js"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/vendor/search.js"></script>
<script async src="../../../_/../search-index.js"></script>
<script src="../../../_/js/vendor/highlight.js"></script>
<script>hljs.initHighlighting()</script>
<script>
  tocbot.init( {
                  tocSelector: '#article-toc',
                  contentSelector: 'article',
                  headingSelector: 'h2, h3, h4, h5, h6',
                  collapseDepth: 6,
                  positionFixedSelector: '#article-toc',
                  scrollSmooth: false
                } );
  var tocList = document.getElementById( 'article-toc' ).getElementsByClassName( 'toc-list' );
  if ( tocList && tocList.length > 0 && tocList[0].childNodes.length > 0 ) {
    document.getElementById( 'article-toc' ).parentNode.classList.remove( 'hidden' );
  }
</script>
  </body>
</html>
