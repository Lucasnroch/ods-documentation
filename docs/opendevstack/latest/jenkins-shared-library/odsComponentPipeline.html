<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: OpenDevStack</title>
    <link rel="canonical" href="https://www.opendevstack.org/ods-documentation/opendevstack/latest/jenkins-shared-library/odsComponentPipeline.html">
    <meta name="generator" content="Antora 2.2.0">
    <link rel="stylesheet" href="../../../_/css/site.css">
<link rel="stylesheet" href="../../../_/css/search.css">
  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.opendevstack.org/ods-documentation">OpenDevStack</a>
        <div class="navbar-item">
          <input id="search-input" type="text" placeholder="Search docs">
        </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="opendevstack" data-version="latest">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../getting-started/index.html">OpenDevStack</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Jenkins Shared Library</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="component-pipeline.html">Component Pipeline</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="quickstarter-pipeline.html">Quickstarter Pipeline</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../quickstarters/index.html">Quickstarters</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../quickstarters/docker-plain.html">BE Docker Plain</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../quickstarters/be-golang-plain.html">BE Golang</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../quickstarters/be-java-springboot.html">BE Java / Spring Boot</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../quickstarters/be-typescript-express.html">BE Node Express</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../quickstarters/be-python-flask.html">BE Python Flask</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../quickstarters/be-scala-akka.html">BE Scala Akka</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../quickstarters/fe-angular.html">FE Angular</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../quickstarters/fe-ionic.html">FE Ionic</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../quickstarters/fe-react.html">FE React</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../quickstarters/fe-vue.html">FE Vue</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../quickstarters/ds-ml-service.html">Data Science Machine Learning Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../quickstarters/ds-jupyter-notebook.html">Data Science Jupyter Notebook</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../quickstarters/ds-rshiny.html">Data Science RShiny app</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../quickstarters/airflow-cluster.html">Airflow</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../quickstarters/e2e-cypress.html">Cypress E2E testing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../quickstarters/e2e-spock-geb.html">Spock, Geb and Unirest E2E testing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../quickstarters/release-manager.html">Release Manager</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../provisioning-app/index.html">Provisioning App</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../provisioning-app/configuration.html">Configuration Guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../provisioning-app/architecture.html">Internal Architecture</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../provisioning-app/faq.html">FAQ</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../jenkins/index.html">Jenkins</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../jenkins/master.html">Jenkins Master</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../jenkins/slave-base.html">Jenkins Slave Base</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../jenkins/webhook-proxy.html">Webhook Proxy</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../sonarqube/index.html">SonarQube</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Update Guides</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../update-guides/2x.html">Migrate to 2.x</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Administration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../administration/installation.html">Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../administration/local-install-requirements.html">Local Installation Requirements</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../administration/install-guide.html">Local Installation (outdated)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../administration/infrastructure-setup.html">Infrastructure Setup (outdated)</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../administration/update.html">Upgrade</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../administration/keycloak.html">Keycloak</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../sonarqube/administration.html">SonarQube</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../jenkins/administration.html">Jenkins</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Contributing to ODS</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contributing/development.html">Development</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contributing/documentation.html">Documentation</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">OpenDevStack</span>
    <span class="version">latest</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">OpenDevStack</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../getting-started/index.html">latest</a>
        </li>
        <li class="version">
          <a href="../../2.x/getting-started/index.html">2.x</a>
        </li>
        <li class="version">
          <a href="../../1.x/getting-started/index.html">1.x</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../getting-started/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
</nav>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">latest</button>
  <div class="version-menu">
    <a class="version is-current" href="odsComponentPipeline.html">latest</a>
    <a class="version is-missing" href="../../2.x/getting-started/index.html">2.x</a>
    <a class="version is-missing" href="../../1.x/getting-started/index.html">1.x</a>
  </div>
</div>
  <div class="edit-this-page"><a href="https://github.com/opendevstack/ods-jenkins-shared-library/edit/master/docs/modules/jenkins-shared-library/pages/odsComponentPipeline.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<div class="sect1">
<h2 id="_pipeline_options"><a class="anchor" href="#_pipeline_options"></a>Pipeline Options</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>odsComponentPipeline</code> can be customized by passing configuration options like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>odsComponentPipeline(
  imageStreamTag: 'cd/jenkins-slave-golang:2.x',
  projectId: projectId,
  componentId: componentId,
  dockerDir: 'foo'
)</pre>
</div>
</div>
<div class="paragraph">
<p>Available options are:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container image to use for the Jenkins agent container. This value is not used when <code>podContainers</code> is set.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">imageStreamTag</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container image tag of an <code>ImageStream</code> in your OpenShift cluster to use for the Jenkins agent container. This value is not used when <code>podContainers</code> or <code>image</code> is set.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">alwaysPullImage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Determine whether to always pull the container image before each build run. Defaults to <code>true</code>. This value is not used when <code>podContainers</code> is set.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resourceRequestMemory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">How much memory the container requests - defaults to 1Gi. This value is not used when <code>podContainers</code> is set.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resourceLimitMemory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum memory the container can use - defaults to 2Gi. This value is not used when <code>podContainers</code> is set.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resourceRequestCpu</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">How much CPU the container requests - defaults to 10mi. This value is not used when <code>podContainers</code> is set.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resourceLimitCpu</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum CPU the container can use - defaults to 300mi. This value is not used when <code>podContainers</code> is set.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">podLabel</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pod label, set by default to a random label to avoid caching issues. Set to a stable label if you want to reuse pods across builds.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">podContainers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom pod containers to use if the default, automatically configured container is not suitable for your use case (e.g. if you need multiple containers such as app and database). See <a href="#_slave_customization">Slave customization</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">podVolumes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Volumes to make available to the pod.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">podServiceAccount</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Serviceaccount to use when running the pod.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">notifyNotGreen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to send notifications if the build is not successful.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">branchToEnvironmentMapping</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Define which branches are deployed to which environments, see <a href="#_git_workflow_branch_to_environment_mapping">Git Workflow / Branch to Environment Mapping</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">autoCloneEnvironmentsFromSourceMapping</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Define which environments are cloned from which source environments.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">projectId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Project ID, e.g. <code>foo</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">componentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Component ID, e.g. <code>be-auth-service</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">environmentLimit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of environments to allow.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dockerDir</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The docker directory to use when building the image in openshift. Defaults to <code>docker</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sonarQubeBranch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deprecated in 3.x! Please use option <code>branch</code> on <code>odsComponentStageScanWithSonar</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">failOnSnykScanVulnerabilities</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deprecated in 3.x! Please use option <code>failOnVulnerabilities</code> on <code>odsComponentStageScanWithSnyk</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">openshiftBuildTimeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deprecated in 3.x! Please use option <code>buildTimeoutMinutes</code> on <code>odsComponentBuildOpenShiftImage</code>.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_pipeline_context"><a class="anchor" href="#_pipeline_context"></a>Pipeline Context</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When you write custom stages inside the closure passed to <code>odsComponentPipeline</code>, you have access to the <code>context</code>, which is assembled for you on the master node. The <code>context</code> can be influenced by changing the config map passed to <code>odsComponentPipeline</code>, see <a href="#_pipeline_options">Pipeline Options</a>.</p>
</div>
<div class="paragraph">
<p>The <code>context</code> object contains the following properties:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jobName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value of JOB_NAME. It is the name of the project of the build.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">buildNumber</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value of BUILD_NUMBER. The current build number, such as <code>153</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">buildUrl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value of BUILD_URL. The URL where the results of the build can be found (e.g. <code><a href="http://buildserver/jenkins/job/MyJobName/123/" class="bare">http://buildserver/jenkins/job/MyJobName/123/</a></code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">buildTime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time of the build, collected when the odsComponentPipeline starts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">credentialsId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Credentials identifier (Credentials are created and named automatically by the OpenShift Jenkins plugin).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tagversion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The tagversion is made up of the build number and the first 8 chars of the commit SHA.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nexusHost</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nexus host (with scheme).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nexusUsername</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nexus username.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nexusPassword</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nexus password.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nexusHostWithBasicAuth</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nexus host (with scheme), including username and password as BasicAuth.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cloneSourceEnv</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The environment which was chosen as the clone source.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">environment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The environment which was chosen as the deployment target, e.g. <code>dev</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">targetProject</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Target project, based on the environment. E.g. <code>foo-dev</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Group ID, defaults to: org.opendevstack.<projectID>.</projectID></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">projectId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Project ID, e.g. <code>foo</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">componentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Component ID, e.g. <code>be-auth-service</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gitUrl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Git URL of repository</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gitBranch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Git branch for which the build runs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gitCommit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Git commit SHA to build.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gitCommitAuthor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Git commit author.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gitCommitMessage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Git commit message.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gitCommitTime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Git commit time in RFC 3399.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">openshiftHost</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OpenShift host - value taken from <code>OPENSHIFT_API_URL</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">odsSharedLibVersion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ODS Jenkins shared library version, taken from reference in <code>Jenkinsfile</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bitbucketUrl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BitBucket URL - value taken from <code>BITBUCKET_URL</code>. If BITBUCKET_URL is not present, it will default to <code><a href="https://&lt;BITBUCKET_HOST&gt;`" class="bare">https://&lt;BITBUCKET_HOST&gt;`</a></code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bitbucketHost</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BitBucket host - value derived from <code>bitbucketUrl</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dockerDir</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The docker directory to use when building the image in openshift. Defaults to <code>docker</code>.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_git_workflow_branch_to_environment_mapping"><a class="anchor" href="#_git_workflow_branch_to_environment_mapping"></a>Git Workflow / Branch to Environment Mapping</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The shared library does not impose which Git workflow you use. Whether you use <a href="https://nvie.com/posts/a-successful-git-branching-model/">git-flow</a>, <a href="https://guides.github.com/introduction/flow/">GitHub flow</a> or a custom workflow, it is possible to configure the pipeline according to your needs by configuring the pipeline option <code>branchToEnvironmentMapping</code>. The setting could look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>branchToEnvironmentMapping: [
  'master': 'prod',
  'develop': 'dev',
  'hotfix/': 'hotfix',
  '*': 'review'
]</pre>
</div>
</div>
<div class="paragraph">
<p>There are three ways to reference branches:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Fixed name (e.g. <code>master</code>)</p>
</li>
<li>
<p>Prefix (ending with a slash, e.g. <code>hotfix/</code>)</p>
</li>
<li>
<p>Any branch (<code>*</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Matches are made top-to-bottom. For prefixes / any branch, a more specific environment might be selected if:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the branch contains a ticket ID and a corresponding env exists in OpenShift. E.g. for mapping <code>"feature/": "dev"</code> and branch <code>feature/foo-123-bar</code>, the env <code>dev-123</code> is selected instead of <code>dev</code> if it exists.</p>
</li>
<li>
<p>the branch name corresponds to an existing env in OpenShift. E.g. for mapping <code>"release/": "rel"</code> and branch <code>release/1.0.0</code>, the env <code>rel-1.0.0</code> is selected instead of <code>rel</code> if it exists.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_examples"><a class="anchor" href="#_examples"></a>Examples</h3>
<div class="paragraph">
<p>If you use git-flow, the following config fits well:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>branchToEnvironmentMapping: [
  'master': 'prod',
  'develop': 'dev',
  'release/': 'rel',
  'hotfix/': 'hotfix',
  '*': 'preview'
]</pre>
</div>
</div>
<div class="paragraph">
<p>If you use GitHub Flow, the following config fits well:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>branchToEnvironmentMapping: [
  'master': 'prod',
  '*': 'preview'
]</pre>
</div>
</div>
<div class="paragraph">
<p>If you use a custom workflow, the config could look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>branchToEnvironmentMapping: [
  'production': 'prod',
  'master': 'dev',
  'staging': 'uat'
]</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_advanced"><a class="anchor" href="#_advanced"></a>Advanced</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_slave_customization"><a class="anchor" href="#_slave_customization"></a>Slave customization</h3>
<div class="paragraph">
<p>The slave used in the pipeline can be customized by adjusting the <code>image</code> (or <code>imageStreamTag</code> to
use. Further, <code>alwaysPullImage</code> (defaulting to <code>true</code>) can be used to
determine whether this image should be refreshed on each build.</p>
</div>
<div class="paragraph">
<p>Resource constraints of the container can be changed via <code>resourceRequestCpu</code>,
<code>resourceLimitCpu</code>, <code>resourceRequestMemory</code> and <code>resourceLimitMemory</code>.</p>
</div>
<div class="paragraph">
<p>The setting <code>podVolumes</code> allows to mount persistent volume claims to the pod
(the value is passed to the <code>podTemplate</code> call as <code>volumes</code>).</p>
</div>
<div class="paragraph">
<p>To completely control the container(s) within the pod, set <code>podContainers</code>
(which is passed to the <code>podTemplate</code> call as <code>containers</code>).</p>
</div>
<div class="paragraph">
<p>Configuring of a customized slave container in a <code>Jenkinsfile</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>odsComponentPipeline(
  projectId: projectId,
  podContainers: [
    containerTemplate(
      name: 'jnlp', // do not change, see https://github.com/jenkinsci/kubernetes-plugin#constraints
      image: "${dockerRegistry}/foo-cd/jenkins-slave-custom",
      workingDir: '/tmp',
      resourceRequestCpu: '100m',
      resourceLimitCpu: '500m',
      resourceRequestMemory: '2Gi',
      resourceLimitMemory: '4Gi',
      alwaysPullImage: true,
      args: '${computer.jnlpmac} ${computer.name}'
    )
  ],
  ...
  ) { context -&gt;
  stageBuild(context)
  ...
}</pre>
</div>
</div>
<div class="paragraph">
<p>See the <a href="https://github.com/jenkinsci/kubernetes-plugin#pod-and-container-template-configuration">kubernetes-plugin</a>
documentation for possible configuration.</p>
</div>
</div>
<div class="sect2">
<h3 id="_git_lfs_git_large_file_storage_extension"><a class="anchor" href="#_git_lfs_git_large_file_storage_extension"></a>Git LFS (Git Large File Storage extension)</h3>
<div class="paragraph">
<p>If you are working with large files (e.g.: binary files, media files, files bigger than 5MB&#8230;&#8203;),
you can follow the following steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Check this HOWTO about <a href="https://www.atlassian.com/git/tutorials/git-lfs">Git LFS</a></p>
</li>
<li>
<p>Track your large files in your local clone, as explained in previous step</p>
</li>
<li>
<p>Enable Git LFS in your repository (if BitBucket: under repository&#8217;s settings main page you can enable it)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>NOTE</strong>: if already having a repository with large files and you want to migrate it to using git LFS:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git lfs migrate</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_automatically_cloning_environments_on_the_fly"><a class="anchor" href="#_automatically_cloning_environments_on_the_fly"></a>Automatically cloning environments on the fly</h3>
<div class="paragraph">
<p>Caution! Cloning environments on-the-fly is an advanced feature and should only be used if you understand OpenShift well, as there are many moving parts and things can go wrong in multiple places.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>autoCloneEnvironmentsFromSourceMapping: [
  "hotfix": "prod",
  "review": "dev"
]</pre>
</div>
</div>
<div class="paragraph">
<p>Instead of deploying multiple branches to the same environment, individual environments can be created on-the-fly. For example, the mapping <code>"*": "review"</code> deploys all branches to the <code>review</code> environment. To have one environment per branch / ticket ID, you can add the <code>review</code> environment to <code>autoCloneEnvironmentsFromSourceMapping</code>, e.g. like this: <code>"review": "dev"</code>. This will create individual environments (named e.g. <code>review-123</code> or <code>review-foobar</code>), each cloned from the <code>dev</code> environment.</p>
</div>
<div class="sect3">
<h4 id="_examples_2"><a class="anchor" href="#_examples_2"></a>Examples</h4>
<div class="paragraph">
<p>If you use git-flow, the following config fits well:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>branchToEnvironmentMapping: [
  'master': 'prod',
  'develop': 'dev',
  'release/': 'rel',
  'hotfix/': 'hotfix',
  '*': 'preview'
]
autoCloneEnvironmentsFromSourceMapping: [
  'rel': 'dev',
  'hotfix': 'prod',
  'preview': 'dev'
]</pre>
</div>
</div>
<div class="paragraph">
<p>If you use GitHub Flow, the following config fits well:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>branchToEnvironmentMapping: [
  'master': 'prod',
  '*': 'preview'
]
autoCloneEnvironmentsFromSourceMapping: [
  'preview': 'prod'
]</pre>
</div>
</div>
<div class="paragraph">
<p>If you use a custom workflow, the config could look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>branchToEnvironmentMapping: [
  'production': 'prod',
  'master': 'dev',
  'staging': 'uat'
]
autoCloneEnvironmentsFromSourceMapping: [
  'uat': 'prod'
]</pre>
</div>
</div>
</div>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.1.1/tocbot.min.js"></script>
<script type="text/javascript">
  window.antora = window.antora || {}
  window.antora.basePath = '../../..'
  window.antora.pagePath = '/opendevstack/latest/jenkins-shared-library/odsComponentPipeline.html'
</script>
<script src="../../../_/js/site.js"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/vendor/search.js"></script>
<script async src="../../../_/../search-index.js"></script>
<script src="../../../_/js/vendor/highlight.js"></script>
<script>hljs.initHighlighting()</script>
<script>
  tocbot.init( {
                  tocSelector: '#article-toc',
                  contentSelector: 'article',
                  headingSelector: 'h2, h3, h4, h5, h6',
                  collapseDepth: 6,
                  positionFixedSelector: '#article-toc',
                  scrollSmooth: false
                } );
  var tocList = document.getElementById( 'article-toc' ).getElementsByClassName( 'toc-list' );
  if ( tocList && tocList.length > 0 && tocList[0].childNodes.length > 0 ) {
    document.getElementById( 'article-toc' ).parentNode.classList.remove( 'hidden' );
  }
</script>
  </body>
</html>
