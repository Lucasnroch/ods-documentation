<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>OpenDevStack Setup :: OpenDevStack</title>
    <link rel="canonical" href="https://www.opendevstack.org/ods-documentation/ods-core/latest/setup/index.html">
    <meta name="generator" content="Antora 2.2.0">
    <link rel="stylesheet" href="../../../_/css/site.css">
<link rel="stylesheet" href="../../../_/css/search.css">
  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.opendevstack.org/ods-documentation">OpenDevStack</a>
        <div class="navbar-item">
          <input id="search-input" type="text" placeholder="Search docs">
        </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Components</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="https://www.opendevstack.org/ods-documentation/common/latest/index.html">Guides and Tutorials</a>
            <a class="navbar-item" href="https://www.opendevstack.org/ods-documentation/ods-jenkins-shared-library/latest/index.html">Jenkins Shared Library</a>
            <a class="navbar-item" href="https://www.opendevstack.org/ods-documentation/ods-core/latest/infrastructure-setup/index.html">ODS Core</a>
            <a class="navbar-item" href="https://www.opendevstack.org/ods-documentation/ods-project-quickstarters/1.2/index.html">ODS Project Quickstarters</a>
            <a class="navbar-item" href="https://www.opendevstack.org/ods-documentation/ods-quickstarters/latest/index.html">ODS Quickstarters</a>
            <a class="navbar-item" href="https://www.opendevstack.org/ods-documentation/ods-provisioning-app/latest/index.html">Provisioning App</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ods-core" data-version="latest">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title">ODS Components</h3>
    <ul class="nav-list">
  <li class="nav-item" data-depth="0">
      <a class="nav-link" href="../../../common/latest/index.html">Guides and Tutorials</a>
      </li>
  <li class="nav-item" data-depth="0">
      <a class="nav-link" href="../../../ods-jenkins-shared-library/latest/index.html">Jenkins Shared Library</a>
      </li>
  <li class="nav-item" data-depth="0">
      <a class="nav-link" href="../infrastructure-setup/index.html">ODS Core</a>
      </li>
  <li class="nav-item" data-depth="0">
      <a class="nav-link" href="../../../ods-project-quickstarters/1.2/index.html">ODS Project Quickstarters</a>
      </li>
  <li class="nav-item" data-depth="0">
      <a class="nav-link" href="../../../ods-quickstarters/latest/index.html">ODS Quickstarters</a>
      </li>
  <li class="nav-item" data-depth="0">
      <a class="nav-link" href="../../../ods-provisioning-app/latest/index.html">Provisioning App</a>
      </li>
    </ul>
    <h3 class="title"><a href="../infrastructure-setup/index.html">ODS Core</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../infrastructure-setup/index.html">Intro</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../sysenv-requirements.html">System and Environment Requirements</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../infrastructure-setup/index.html">Infrastructure Setup</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jenkins</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../jenkins/index.html">Jenkins Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../jenkins/webhook-proxy.html">Webhook Proxy</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../jenkins/slave-base.html">Jenkins Slave Base Image</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../sonarqube/index.html">Sonarqube</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../keycloak/index.html">Keycloak</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">ODS Core</span>
    <span class="version">latest</span>
  </div>
  <ul class="components">
    <li class="component">
      <span class="title">Guides and Tutorials</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../common/latest/index.html">latest</a>
        </li>
        <li class="version">
          <a href="../../../common/1.2/index.html">1.2</a>
        </li>
        <li class="version">
          <a href="../../../common/1.1/index.html">1.1</a>
        </li>
        <li class="version">
          <a href="../../../common/v1.0/index.html">v1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Jenkins Shared Library</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../ods-jenkins-shared-library/latest/index.html">latest</a>
        </li>
        <li class="version">
          <a href="../../../ods-jenkins-shared-library/2/index.html">2</a>
        </li>
        <li class="version">
          <a href="../../../ods-jenkins-shared-library/1.2/index.html">1.2</a>
        </li>
        <li class="version">
          <a href="../../../ods-jenkins-shared-library/1.1/index.html">1.1</a>
        </li>
        <li class="version">
          <a href="../../../ods-jenkins-shared-library/v1.0/index.html">v1.0</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <span class="title">ODS Core</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../infrastructure-setup/index.html">latest</a>
        </li>
        <li class="version">
          <a href="../../2/infrastructure-setup/index.html">2</a>
        </li>
        <li class="version">
          <a href="../../1.2/infrastructure-setup/index.html">1.2</a>
        </li>
        <li class="version">
          <a href="../../1.1/infrastructure-setup/index.html">1.1</a>
        </li>
        <li class="version">
          <a href="../../v1.0/infrastructure-setup/index.html">v1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">ODS Project Quickstarters</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../ods-project-quickstarters/1.2/index.html">1.2</a>
        </li>
        <li class="version">
          <a href="../../../ods-project-quickstarters/1.1/index.html">1.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">ODS Quickstarters</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../ods-quickstarters/latest/index.html">latest</a>
        </li>
        <li class="version">
          <a href="../../../ods-quickstarters/2/index.html">2</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Provisioning App</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../ods-provisioning-app/latest/index.html">latest</a>
        </li>
        <li class="version">
          <a href="../../../ods-provisioning-app/2/index.html">2</a>
        </li>
        <li class="version">
          <a href="../../../ods-provisioning-app/1.2/index.html">1.2</a>
        </li>
        <li class="version">
          <a href="../../../ods-provisioning-app/1.1/index.html">1.1</a>
        </li>
        <li class="version">
          <a href="../../../ods-provisioning-app/v1.0/index.html">v1.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main>
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../common/latest/getting-started/introduction.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../infrastructure-setup/index.html">ODS Core</a></li>
    <li><a href="index.html">OpenDevStack Setup</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">latest</button>
  <div class="version-menu">
    <a class="version is-current" href="index.html">latest</a>
    <a class="version is-missing" href="../../2/infrastructure-setup/index.html">2</a>
    <a class="version is-missing" href="../../1.2/infrastructure-setup/index.html">1.2</a>
    <a class="version is-missing" href="../../1.1/infrastructure-setup/index.html">1.1</a>
    <a class="version is-missing" href="../../v1.0/infrastructure-setup/index.html">v1.0</a>
  </div>
</div>
  <div class="edit-this-page"><a href="https://github.com/opendevstack/ods-core/edit/master/docs/modules/setup/pages/index.adoc">Edit this Page</a></div>
  </div>
<article class="doc"><a name="section-top"></a>
<h1 class="page">OpenDevStack Setup</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This document will guide you through installing / maintaining an OpenDevStack installation.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_local_setup"><a class="anchor" href="#_local_setup"></a>Local Setup</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_repositories"><a class="anchor" href="#_repositories"></a>Repositories</h3>
<div class="paragraph">
<p>If you do not have the ODS repositories setup yet, go to your Terminal and run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">mkdir -p opendevstack
cd opendevstack
curl -LO https://raw.githubusercontent.com/opendevstack/ods-core/master/ods-setup/repos.sh
chmod +x repos.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are installing OpenDevStack for the first time, run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">./repos.sh --init</code></pre>
</div>
</div>
<div class="paragraph">
<p>If there is already an existing installation of OpenDevStack, run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">./repos.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>The script will prompt you which Git ref you want to use. Select either <code>master</code> for bleeding edge or a more stable "version" such as <code>2.x</code>. Afterwards running this script, all required repositories should be available locally.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuration"><a class="anchor" href="#_configuration"></a>Configuration</h3>
<div class="paragraph">
<p>Go to <code>ods-core</code> and run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">make prepare-config</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to install OpenDevStack for the first time, leave the BitBucket URL empty.</p>
</div>
<div class="paragraph">
<p>After the configuration is prepared, fill out all the parameters for your installation and commit the result.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_atlassian_tools"><a class="anchor" href="#_atlassian_tools"></a>Atlassian Tools</h2>
<div class="sectionbody">
<div class="paragraph">
<p>At this stage you can setup the Atlassian tools if they do not exist yet, or modify them as needed. Documentation for this is not complete / up-to-date but may be found at:</p>
</div>
<div class="paragraph">
<p>Unresolved include directive in modules/setup/pages/index.adoc - include::infrastructure-setup/pages/index.adoc[]</p>
</div>
<div class="paragraph">
<p>After Bitbucket is running, create the <code>OPENDEVSTACK</code> project and create bare repositories for each OpenDevStack repository that you have setup locally.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_openshift_cluster"><a class="anchor" href="#_openshift_cluster"></a>OpenShift cluster</h2>
<div class="sectionbody">
<div class="paragraph">
<p>At this stage you can setup the OpenShift cluster if it does not exist yet. Documentation for this is missing right now. Locally, some version of <code>oc cluster up</code> will do the trick.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bitbucket_repoisitories"><a class="anchor" href="#_bitbucket_repoisitories"></a>Bitbucket Repoisitories</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is important that all repositories in BitBucket are up-to-date and ready to be used e.g. from <code>BuildConfig</code> resources in OpenShift.</p>
</div>
<div class="paragraph">
<p>In <code>ods-core</code> run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">make sync-repos</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, in <code>ods-configuration</code> run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">git push origin master</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_opendevstack_environment_in_openshift"><a class="anchor" href="#_opendevstack_environment_in_openshift"></a>OpenDevStack environment in OpenShift</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_central_cd_project"><a class="anchor" href="#_central_cd_project"></a>Central CD project</h3>
<div class="paragraph">
<p>OpenDevStack needs one central <code>cd</code> project in OpenShift, which will hold all shared resources such as images or deployments.</p>
</div>
<div class="paragraph">
<p>In <code>ods-core</code> run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">make install-cd-project</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_nexus"><a class="anchor" href="#_nexus"></a>Nexus</h3>
<div class="paragraph">
<p>A central Nexus deployment is used to proxy packages and to store artifacts.</p>
</div>
<div class="paragraph">
<p>In <code>ods-core</code> run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">make install-nexus</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_sonarqube"><a class="anchor" href="#_sonarqube"></a>SonarQube</h3>
<div class="paragraph">
<p>A central SonarQube deployment is used to analyze source code.</p>
</div>
<div class="paragraph">
<p>In <code>ods-core</code> run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">make install-sonarqube</code></pre>
</div>
</div>
<div class="paragraph">
<p>Afterwards, perform the following manual steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Change admin password</p>
</li>
<li>
<p>Lock SonarQube to logged-in users (Administation &gt; Configuration &gt; Security &gt; Force User Authentication).</p>
</li>
<li>
<p>Log in as <code>cd_user</code> and created an auth token (My Account &gt; Security &gt; Generate New Token).</p>
</li>
<li>
<p>As the auth token and the admin password have changed, update your OpenShift configuration repository and the <code>sonarqube-app</code> secret.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_jenkins"><a class="anchor" href="#_jenkins"></a>Jenkins</h3>
<div class="paragraph">
<p>Central Jenkins images (master, agent, webhook proxy) are used by every ODS project.</p>
</div>
<div class="paragraph">
<p>In <code>ods-core</code> run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">make install-jenkins</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_provisioning_application"><a class="anchor" href="#_provisioning_application"></a>Provisioning Application</h3>
<div class="paragraph">
<p>At this stage you can setup or modify the provisioning application. Installation of this will change in the next version of OpenDevStack. Instructions will be added here then.</p>
</div>
<div class="paragraph">
<p>Congratulations! At this point you should have a complete ODS installation. Try it out by provisioning a new project with the provisioning application.</p>
</div>
</div>
</div>
</div>
</article>
<aside class="article-aside hidden" role="navigation">
  <h3 class="toc-title">Contents</h3>
  <div id="article-toc"></div>
</aside>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.1.1/tocbot.min.js"></script>
<script type="text/javascript">
  window.antora = window.antora || {}
  window.antora.basePath = '../../..'
  window.antora.pagePath = '/ods-core/latest/setup/index.html'
</script>
<script src="../../../_/js/site.js"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/vendor/search.js"></script>
<script async src="../../../_/../search-index.js"></script>
<script src="../../../_/js/vendor/highlight.js"></script>
<script>hljs.initHighlighting()</script>
<script>
  tocbot.init( {
                  tocSelector: '#article-toc',
                  contentSelector: 'article',
                  headingSelector: 'h2, h3, h4, h5, h6',
                  collapseDepth: 6,
                  positionFixedSelector: '#article-toc',
                  scrollSmooth: false
                } );
  var tocList = document.getElementById( 'article-toc' ).getElementsByClassName( 'toc-list' );
  if ( tocList && tocList.length > 0 && tocList[0].childNodes.length > 0 ) {
    document.getElementById( 'article-toc' ).parentNode.classList.remove( 'hidden' );
  }
</script>
  </body>
</html>
