# The ODS Antora Playbook Repository

## Building documentation locally

### Prerequisites

#### Antora
Antora has to be installed according to the https://docs.antora.org/antora/2.0/install/install-antora/[Install Antora] guide.

#### OpenDevStack Repositories
The following OpenDevStack Repositories have to be cloned and stored beside the _ods-documentation_ repository:

- `opendevstack.github.io`
- `ods-core`
- `ods-jenkins-shared-library`
- `ods-provisioning-app`
- `ods-project-quickstarters`
- `ods-quickstarters`

#### PlantUML-Server

Because we use PlantUML for creating of diagrams, it is important, that a plantuml server is running.
Currently the system is configured to use a local plantuml server when building locally.
Plantuml server can be downloaded from https://github.com/plantuml/plantuml-server. It runs as
docker container or can be started with a jetty server out of the box. See the documentation at
github and the following explanations for details.


*Start as Docker container:*

You can start a server using a docker container

    docker run -d -p 9080:8080 plantuml/plantuml-server:jetty

Then you are able to generate the documentation.

*Start as jetty server via maven*:

    mvn jetty:run -Djetty.port=9080 -Djetty.contextpath=/

*Classic way (not recommend)*:

Since PlantUML is a simple web application, you can even go the classic way and build a war - archive
and deploy it to your java application server.


### Run the documentation locally

The documentation build is defined by a playbook. There are 3 different playbook versions with different behavior:

#### `site.yml`

This fetches the different referenced repositories from GitHub.

  antora generate site.yml

#### `site-workspace.yml`

To preview your local changes, just building documentation from `HEAD`.

   antora generate site-workspace.yml

The output will be written to `docs_local`, which is ignored by git. This directory is only for local preview and verification.

#### `site-workspace-full.yml`

To preview your local changes, taking into account all branches.

   antora generate site-workspace-full.yml

The output will be written to `docs_local`, which is ignored by git. This directory is only for local preview and verification.

### Customize the UI

By defualt, the playbooks reference a UI bundle from https://github.com/opendevstack/ods-docs-ui/releases. You can also clone that repo locally, customize the UI, build a new UI bundle and reference that when running `antora`.

To build a UI bundle, read the documentation at
https://github.com/opendevstack/ods-docs-ui/blob/ods-docs-ui/README.adoc. Example:

    cd ../ods-docs-ui
    # Compile
    npm install
    # Create file ui-bundle.zip
    gulp bundle
    # Reference it
    cd ../ods-documentation
    antora generate site-workspace.yml --ui-bundle-url ../ods-docs-ui/build/ui-bundle.zip

## Building on Travis

Whenever this repository is pushed to GitHub, it triggers a travis build,
that regenerates the antora documentation based on the `site.yml` playbook. The
updated content in directory docs will be pushed back to the githup repository during the build.

See xref:.travis.yml[.travis.yml] for details.
